**系統整合LINE登入前端筆記** 
===
##### 更新時間：2025-10-03 10:39

## 環境：Angular 框架、後端abp框架  
參考官方文件：[integrate-line-login](https://developers.line.biz/en/docs/line-login/integrate-line-login/)  

## 流程：  

1.呼叫後端API取得一組由後端生成的隨機碼

2.點選'使用LINE帳號登入'時，轉導至LINE登入畫面  
> * 需準備
>> 1.client_id：就是line developers console 頁面中的 LINE Login Channel ID  
>> 2.redirect_uri：登入成功後跳轉回來的頁面，也須一起設定在line developers console中  
>> 3.state：從後端那取得的隨機碼，防止CSP攻擊  

> * 從上述中拼湊出轉導line登入Url：https://access.line.me/oauth2/v2.1/authorize?response_type=code&client_id=1234567890&redirect_uri=https%3A%2F%2Fexample.com%2Fauth%3Fkey%3Dvalue&state=12345abcde&scope=profile%20openid&nonce=09876xyz  


3.使用者登入完成，依據設定的callbackUrl，轉導至指定頁面(例如：登入畫面或是首頁)  

4.進入callbackUrl畫面初始時，檢查route是否帶有code和state等資訊(LINE 返回的授權碼)  

> * 情況1:驗證通過，呼叫後端API，將code與state傳遞給後端，供後端驗證使用。  
> * 情況2:驗證失敗，結束，跳出失敗提醒視窗。

5.收到後端回覆

> * 該登入的用戶已註冊-->登入成功，大功告成。
> * 該登入的用戶未註冊-->依據公司業務邏輯決定下一步。

6.可能的第六步  

> 登入成功後，因為第四步的情況1，後端登入並非使用abp 原生的登入方式(AuthService.login)，故登入成功後，可能須自行處理其他預設的登入邏輯。  






